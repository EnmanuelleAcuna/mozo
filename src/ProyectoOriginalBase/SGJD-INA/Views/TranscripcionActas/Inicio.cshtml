@using SGJD_INA.Models.ViewModels

@model ActaTranscritaViewModel

@{
    ViewBag.Title = "Transcribir Acta";
}

<div class="row mt-2">
    <div class="col s12 m4">
        <h6 class="seccion white-text truncate">
            <a title="Regresar" href="@Url.Action("Inicio", "Actas")">
                <i class="fa fa-arrow-left white-text">&nbsp;</i>
            </a>
            Transcribir Acta de Sesión
        </h6>
    </div>
    <div class="col s12 m8 hide-on-med-and-down">
        <nav class="transparent z-depth-0 breadcrumb">
            <div class="nav-wrapper right">
                <div class="col s12">
                    <a href="@Url.Action("Inicio", "Inicio")" class="breadcrumb">Inicio</a>
                    <a href="@Url.Action("Actas", "Inicio")" class="breadcrumb">Módulo de Actas</a>
                    <a href="@Url.Action("Inicio", "Actas")" class="breadcrumb">Actas de Sesión</a>
                </div>
            </div>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col s12">
        <div class="card-panel">
            @using (Html.BeginForm("Inicio", "TranscripcionActas", FormMethod.Post, htmlAttributes: new { autocomplete = "off", enctype = "multipart/form-data" })) {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(true, "", new { @class = "data-error" })

                @Html.HiddenFor(model => model.Transcripcion)

                <div class="row mb-0">
                    <div class="col s12">
                        <div class="row">
                            <div class="col s12 m2 max-width-64px">
                                <svg viewBox="0 0 18 18" focusable="false" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="ext-quickStartIcon msportalfx-svg-placeholder" role="presentation"><g><title></title><defs></defs><path d="M7.3 7.019h10.041a.659.659 0 0 1 .659.658v7.981a.66.66 0 0 1-.659.658h-4.11a.109.109 0 0 0-.067.023l-2.108 1.615a.219.219 0 0 1-.353-.174v-1.354a.11.11 0 0 0-.109-.11H7.3a.659.659 0 0 1-.658-.658V7.677a.66.66 0 0 1 .658-.658z" fill="#50e6ff"></path><path d="M11.361.659v7.98a.659.659 0 0 1-.661.661H7.4a.11.11 0 0 0-.109.11v1.355a.22.22 0 0 1-.353.174L4.836 9.32a.109.109 0 0 0-.067-.02H.659A.66.66 0 0 1 0 8.639V.659A.659.659 0 0 1 .659 0H10.7a.66.66 0 0 1 .661.659z" fill="url(#e55d0c29-af1e-47f8-8687-3b57784a9fe2)"></path><path d="M8.1 4.26a3.48 3.48 0 0 1-.07.7 3.688 3.688 0 0 1-.2.667 3.249 3.249 0 0 1-.329.615 4.03 4.03 0 0 1-.336.426.156.156 0 0 1-.226 0l-.031-.03a.159.159 0 0 1 0-.22 3.261 3.261 0 0 0 .3-.378 3.164 3.164 0 0 0 .477-1.153 3.242 3.242 0 0 0 0-1.262 3.13 3.13 0 0 0-.181-.6 3.311 3.311 0 0 0-.3-.553 3.107 3.107 0 0 0-.3-.38.16.16 0 0 1 0-.22l.032-.031a.156.156 0 0 1 .225 0 3.555 3.555 0 0 1 .336.428 3.453 3.453 0 0 1 .326.615 3.76 3.76 0 0 1 .2.667 3.3 3.3 0 0 1 .077.709zM6.924 3.3a2.516 2.516 0 0 0-.431-.693.155.155 0 0 0-.226 0l-.031.031a.154.154 0 0 0-.01.211 2.142 2.142 0 0 1 0 2.825.155.155 0 0 0 .01.212l.031.031a.155.155 0 0 0 .226 0 2.546 2.546 0 0 0 .431-.693 2.51 2.51 0 0 0 0-1.916zm-1.238.3a1.134 1.134 0 0 1 .143.248 1.088 1.088 0 0 1 0 .824 1.011 1.011 0 0 1-.142.245.156.156 0 0 0 .014.205l.03.03a.159.159 0 0 0 .235-.012 1.421 1.421 0 0 0 .2-.334 1.444 1.444 0 0 0 .106-.547 1.486 1.486 0 0 0-.109-.547 1.359 1.359 0 0 0-.193-.332.158.158 0 0 0-.236-.013L5.7 3.4a.153.153 0 0 0-.014.2zm-2-.413h-.372A.314.314 0 0 0 3 3.5v1.518a.315.315 0 0 0 .314.314h.374a.314.314 0 0 1 .222.092l.937.935a.161.161 0 0 0 .111.046.187.187 0 0 0 .187-.187V2.3a.189.189 0 0 0-.189-.189.162.162 0 0 0-.112.046L3.91 3.1a.315.315 0 0 1-.222.088zm11.525 7.745a.831.831 0 1 1-.83.83.83.83 0 0 1 .83-.83zm-3.48.837a.831.831 0 1 0 .831-.83.831.831 0 0 0-.831.83zm-2.649 0a.831.831 0 1 0 .831-.83.831.831 0 0 0-.831.83z" class="msportalfx-svg-c01"></path></g></svg>
                            </div>
                            <div class="col s12 m10">
                                <h6 class="blue-text">
                                    Transcribir audio con Microsoft Cognitive Services - Azure Speech
                                </h6>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-0 contenedor-seleccion">
                    <div class="col s12 m6">
                        <div class="file-field input-field">
                            <div class="btn btn-small grey lighten-3 black-text">
                                <span>Audio de la Sesión</span>
                                <input type="file" name="Audio" id="Audio" placeholder="Seleccione el audio a transcribir">
                            </div>
                            <div class="file-path-wrapper">
                                <input class="file-path validate" type="text">
                            </div>
                        </div>
                    </div>

                    <div class="col s12 m6">
                        <label>Iniciar proceso de transcripción</label>
                        <button type="submit" title="Transcribir" value="Transcribir" id="BtnTranscribir" class="btn blue waves-effect waves-teal white-text font-bold display-block">
                            <i class="fa fa-file-alt left"></i>
                            <i class="fa fa-long-arrow-alt-right left"></i>
                            <i class="fa fa-volume-up left"></i>
                            Transcribir
                        </button>
                    </div>
                </div>

                <div class="row">
                    @* Preloader guardar Orden del Día *@
                    <div class="col s12 preloader-guardar-acta" hidden>
                        <label>Transcribiendo...</label>
                        <div class="progress">
                            <div class="indeterminate"></div>
                        </div>
                    </div>
                </div>

                if (!string.IsNullOrEmpty(Model.Transcripcion)) {
                    <div class="row">
                        <div class="col s12 mb-1">
                            @Html.LabelFor(model => model.Transcripcion, new { @class = "black-text font-bold" })
                            <div id="EditorTranscripcion">
                                @Html.Raw(Model.Transcripcion)
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>

@Styles.Render("~/Content/quill")

@section Scripts{
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/quill")

    @{
        System.Web.Script.Serialization.JavaScriptSerializer Serializer = new System.Web.Script.Serialization.JavaScriptSerializer();
        Serializer.MaxJsonLength = Int32.MaxValue;
    }

    <script type="text/javascript">
        // Definición de objetos para cargar el editor de texto enriquecido WYSIWYG QuillJS
        var EditorEncabezado = new Quill("#EditorTranscripcion", OpcionesQuillJS);

        $(document).ready(function () {
            const Transcripcion = @Html.Raw(Serializer.Serialize(Model)); // Convertir y guardar el ViewModel en un objeto JSON

            // Inicializar editores QuillJS para transcripción y los select de asistentes
            InicializarEditoresQuill(Transcripcion, false, 0);
        });

        $("#BtnTranscribir").click(function () {
            $(".contenedor-seleccion").slideUp();
            $(".preloader-guardar-acta").show();
        });

        // Guardar el Acta
        function SubmitFormEditarActa(form) {
            MostrarMensajeInformacion("Guardando información");

            // Obtener el valor del editor, incluyendo formato HTML y guardarlo en los inputs establecidos en Razor
            $("#Transcripcion").val(EditorEncabezado.root.innerHTML);

            // Validar que los campos del formulario estén llenos y tengan los valores correctos
            $.validator.unobtrusive.parse(form);

            if ($(form).valid()) {
                $.ajax({
                    type: "POST",
                    url: form.action,
                    data: $(form).serialize(),
                    success: function (data) {
                        if (data.success) {
                            MostrarMensajeExito(data.Mensaje); // Notificar
                        } else {
                            MostrarMensajeError(data.Mensaje); // Notificar error
                        }
                    },
                    error: function () {
                        MostrarMensajeError(""); //Notificar error
                    },
                    complete: function () {
                    }
                });
            }
            return false;
        }
    </script>

    @Scripts.Render("~/bundles/quillextra")
}